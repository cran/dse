#!/bin/sh


if [  $# -gt 3 ]; then
  echo usage:
  echo "  run.test  test.input.file [nsize [vsize]]"
  exit 1
fi 

# assuming the DSE R libraries are in the pwd set
#R_LIBS=${R_LIBS:=$PWD/rlibs} export R_LIBS
#echo R_LIBS set to $R_LIBS

echo "+++++++++++++++++++++++++++++++++++++++++++++++++"
echo "         running R  $1"

rm -f .RData
d=`date`

log=/tmp/$1.log$$

if    [  $# -eq 1 ]; then
   R --nsize=1M --vsize=10M --no-save --quiet <$1 >$log
elif  [  $# -eq 2 ]; then
   R --nsize=$2 --vsize=10M --no-save --quiet <$1 >$log
elif  [  $# -eq 3 ]; then
   R --nsize=$2 --vsize=$3 --no-save --quiet <$1 >$log
fi 

echo "========================================="
echo "$1 timing:"
echo "start" $d
echo "end  " `date`
echo `uname -a`
echo "========================================="

OK=`grep "OK" $log | wc -l`
ok=`grep "ok" $log | wc -l`
cm=`grep "completed" $log | wc -l`
fa=`grep "FAILED" $log | wc -l`
er=`grep "Error" $log | wc -l`
ht=`grep "Execution halted" $log | wc -l`

echo OK $OK, ok $ok, completed $cm, FAILED $fa 
grep Expecting $log
rm -f .RData

if [ $fa -gt 0  -o  $er -gt 0  -o $ht -gt 0 ]; then
 cat $log;
 rm $log
 exit 1
fi

rm -f $log
exit 0

